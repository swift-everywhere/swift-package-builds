name: Build Major Packages
on:
  workflow_dispatch:
  schedule:
    - cron: '0 * * * *'
  push:
    branches: [main]
    paths:
      - '.github/workflows/buildmajor.yml'

jobs:
  build-major-packages:
    runs-on: macos-latest
    steps:
      - name: Setup Android Toolchain
        id: setup-toolchain-android
        uses: skiptools/swift-android-action@main
        with:
          # just set up the toolchain and don't build anything
          build-package: false
          # build with the latest 6.1
          swift-version: 6.1

      - name: Checkout swift-algorithms
        uses: actions/checkout@v4
        with:
          repository: apple/swift-algorithms
          path: swift-algorithms
      - name: Build swift-algorithms
        shell: bash
        working-directory: swift-algorithms
        run: |
          ${{ steps.setup-toolchain-android.outputs.swift-build }} --build-tests

      - name: Checkout swift-crypto
        uses: actions/checkout@v4
        with:
          repository: apple/swift-crypto
          path: swift-crypto
      - name: Build swift-crypto
        shell: bash
        working-directory: swift-crypto
        run: |
          ${{ steps.setup-toolchain-android.outputs.swift-build }} --build-tests

